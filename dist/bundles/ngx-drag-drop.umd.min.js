!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define("ngx-drag-drop",["exports","@angular/core","@angular/common"],t):t(e["ngx-drag-drop"]={},e.ng.core,e.ng.common)}(this,function(e,i,t){"use strict";var s=["move","copy","link"],l="application/x-dnd",f="application/json",p="Text";function a(e){return e.substr(0,l.length)===l}function o(e){if(e.dataTransfer){var t=e.dataTransfer.types;if(!t)return p;for(var n=0;n<t.length;n++)if(t[n]===p||t[n]===f||a(t[n]))return t[n]}return null}function g(e,t){return"all"===t||"uninitialized"===t?e:e.filter(function(e){return-1!==t.toLowerCase().indexOf(e)})}function d(e,t){var n=window.getComputedStyle(t),r=parseFloat(n.paddingTop)||0,i=parseFloat(n.paddingLeft)||0,d=parseFloat(n.borderTopWidth)||0,a=parseFloat(n.borderLeftWidth)||0;return{x:e.offsetX+i+a,y:e.offsetY+r+d}}var u={isDragging:!1,dropEffect:"none",effectAllowed:"all",type:undefined};function r(){u.isDragging=!1,u.dropEffect=undefined,u.effectAllowed=undefined,u.type=undefined}function h(e,t){!0===u.isDragging&&(u.dropEffect=t),e.dataTransfer.dropEffect=t}function c(e,t){var n=e.dataTransfer?e.dataTransfer.effectAllowed:"uninitialized",r=g(s,n);return!0===u.isDragging&&(r=g(r,u.effectAllowed)),t&&(r=g(r,t)),0===r.length?"none":e.ctrlKey&&-1!==r.indexOf("copy")?"copy":e.altKey&&-1!==r.indexOf("link")?"link":r[0]}function v(e){if(!0===u.isDragging)return u.type;var t=o(e);return null===t?undefined:t===p||t===f?undefined:t.substr(l.length+1)||undefined}function D(){return!1===u.isDragging}var m=u,n=function(){function e(e,t){e.registerDragImage(t)}return e.decorators=[{type:i.Directive,args:[{selector:"[dndDragImageRef]"}]}],e.ctorParameters=function(){return[{type:y},{type:i.ElementRef}]},e}(),y=function(){function e(e,t,n){var r=this;this.elementRef=e,this.renderer=t,this.ngZone=n,this.dndEffectAllowed="copy",this.dndDraggingClass="dndDragging",this.dndDraggingSourceClass="dndDraggingSource",this.dndDraggableDisabledClass="dndDraggableDisabled",this.dndDragImageOffsetFunction=d,this.dndStart=new i.EventEmitter,this.dndDrag=new i.EventEmitter,this.dndEnd=new i.EventEmitter,this.dndMoved=new i.EventEmitter,this.dndCopied=new i.EventEmitter,this.dndLinked=new i.EventEmitter,this.dndCanceled=new i.EventEmitter,this.draggable=!0,this.isDragStarted=!1,this.dragEventHandler=function(e){return r.onDrag(e)}}return Object.defineProperty(e.prototype,"dndDisableIf",{set:function(e){this.draggable=!e,this.draggable?this.renderer.removeClass(this.elementRef.nativeElement,this.dndDraggableDisabledClass):this.renderer.addClass(this.elementRef.nativeElement,this.dndDraggableDisabledClass)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dndDisableDragIf",{set:function(e){this.dndDisableIf=e},enumerable:!0,configurable:!0}),e.prototype.ngAfterViewInit=function(){var e=this;this.addHostListeners(),this.ngZone.runOutsideAngular(function(){e.elementRef.nativeElement.addEventListener("drag",e.dragEventHandler)})},e.prototype.ngOnDestroy=function(){this.elementRef.nativeElement.removeEventListener("drag",this.dragEventHandler),!0===this.isDragStarted&&r()},e.prototype.toggleDragLock=function(e,t,n){void 0===n&&(n=!1),e?(this.componentThatLocked=t,this.removeHostListeners()):t===this.componentThatLocked&&(this.componentThatLocked=null,this.addHostListeners())},e.prototype.onDragStart=function(e){var t=this;if(!1===this.draggable)return!1;if("undefined"!=typeof this.dndHandle&&"undefined"==typeof e._dndUsingHandle)return!1;!function r(e,t,n){u.isDragging=!0,u.dropEffect="none",u.effectAllowed=t,u.type=n,e.dataTransfer.effectAllowed=t}(e,this.dndEffectAllowed,this.dndType),this.isDragStarted=!0,function o(e,t,n){var r=l+(t.type?"-"+t.type:""),i=JSON.stringify(t);try{e.dataTransfer.setData(r,i)}catch(a){try{e.dataTransfer.setData(f,i)}catch(a){var d=g(s,n);e.dataTransfer.effectAllowed=d[0],e.dataTransfer.setData(p,i)}}}(e,{data:this.dndDraggable,type:this.dndType},m.effectAllowed),this.dragImage=this.determineDragImage(),this.renderer.addClass(this.dragImage,this.dndDraggingClass),"undefined"==typeof this.dndDragImageElementRef&&"undefined"==typeof e._dndUsingHandle||function i(e,t,n){var r=n(e,t)||{x:0,y:0};e.dataTransfer.setDragImage(t,r.x,r.y)}(e,this.dragImage,this.dndDragImageOffsetFunction);var n=this.renderer.listen(this.elementRef.nativeElement,"drag",function(){t.renderer.addClass(t.elementRef.nativeElement,t.dndDraggingSourceClass),n()});this.dndStart.emit(e)},e.prototype.onDrag=function(e){this.dndDrag.emit(e)},e.prototype.onDragEnd=function(e){var t,n=this;switch(m.dropEffect){case"copy":t=this.dndCopied;break;case"link":t=this.dndLinked;break;case"move":t=this.dndMoved;break;default:t=this.dndCanceled}t.emit(e),this.dndEnd.emit(e),r(),this.isDragStarted=!1,this.renderer.removeClass(this.dragImage,this.dndDraggingClass),window.setTimeout(function(){n.renderer.removeClass(n.elementRef.nativeElement,n.dndDraggingSourceClass)},0),e.stopPropagation()},e.prototype.registerDragHandle=function(e){this.dndHandle=e},e.prototype.registerDragImage=function(e){this.dndDragImageElementRef=e},e.prototype.determineDragImage=function(){return"undefined"!=typeof this.dndDragImageElementRef?this.dndDragImageElementRef.nativeElement:this.elementRef.nativeElement},e.prototype.addHostListeners=function(){this.draggable=!0,this.dragStartListener||(this.dragStartListener=this.renderer.listen(this.elementRef.nativeElement,"dragstart",this.onDragStart.bind(this))),this.dragEndListener||(this.dragEndListener=this.renderer.listen(this.elementRef.nativeElement,"dragend",this.onDragEnd.bind(this)))},e.prototype.removeHostListeners=function(){this.draggable=!1,this.dragStartListener&&this.dragStartListener(),this.dragEndListener&&this.dragEndListener()},e.decorators=[{type:i.Directive,args:[{selector:"[dndDraggable]",exportAs:"ngxDraggable"}]}],e.ctorParameters=function(){return[{type:i.ElementRef},{type:i.Renderer2},{type:i.NgZone}]},e.propDecorators={dndDraggable:[{type:i.Input}],dndEffectAllowed:[{type:i.Input}],dndType:[{type:i.Input}],dndDraggingClass:[{type:i.Input}],dndDraggingSourceClass:[{type:i.Input}],dndDraggableDisabledClass:[{type:i.Input}],dndDragImageOffsetFunction:[{type:i.Input}],dndStart:[{type:i.Output}],dndDrag:[{type:i.Output}],dndEnd:[{type:i.Output}],dndMoved:[{type:i.Output}],dndCopied:[{type:i.Output}],dndLinked:[{type:i.Output}],dndCanceled:[{type:i.Output}],draggable:[{type:i.HostBinding,args:["attr.draggable"]}],dndDisableIf:[{type:i.Input}],dndDisableDragIf:[{type:i.Input}]},e}(),E=function(){function e(e){this.elementRef=e}return e.decorators=[{type:i.Directive,args:[{selector:"[dndPlaceholderRef]"}]}],e.ctorParameters=function(){return[{type:i.ElementRef}]},e}(),b=function(){function e(e,t,n){var r=this;this.ngZone=e,this.elementRef=t,this.renderer=n,this.dndAllowExternal=!1,this.dndHorizontal=!1,this.dndDragoverClass="dndDragover",this.dndDropzoneDisabledClass="dndDropzoneDisabled",this.dndDragover=new i.EventEmitter,this.dndDrop=new i.EventEmitter,this.placeholder=null,this.disabled=!1,this.dragEnterEventHandler=function(e){return r.onDragEnter(e)},this.dragOverEventHandler=function(e){return r.onDragOver(e)},this.dragLeaveEventHandler=function(e){return r.onDragLeave(e)}}return Object.defineProperty(e.prototype,"dndDisableIf",{set:function(e){this.disabled=!!e,this.disabled?this.renderer.addClass(this.elementRef.nativeElement,this.dndDropzoneDisabledClass):this.renderer.removeClass(this.elementRef.nativeElement,this.dndDropzoneDisabledClass)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dndDisableDropIf",{set:function(e){this.dndDisableIf=e},enumerable:!0,configurable:!0}),e.prototype.ngAfterViewInit=function(){var e=this;this.placeholder=this.tryGetPlaceholder(),this.removePlaceholderFromDOM(),this.ngZone.runOutsideAngular(function(){e.elementRef.nativeElement.addEventListener("dragenter",e.dragEnterEventHandler),e.elementRef.nativeElement.addEventListener("dragover",e.dragOverEventHandler),e.elementRef.nativeElement.addEventListener("dragleave",e.dragLeaveEventHandler)})},e.prototype.ngOnDestroy=function(){this.elementRef.nativeElement.removeEventListener("dragenter",this.dragEnterEventHandler),this.elementRef.nativeElement.removeEventListener("dragover",this.dragOverEventHandler),this.elementRef.nativeElement.removeEventListener("dragleave",this.dragLeaveEventHandler)},e.prototype.onDragEnter=function(e){if(!0!==e._dndDropzoneActive){if("undefined"==typeof e._dndDropzoneActive){var t=document.elementFromPoint(e.clientX,e.clientY);this.elementRef.nativeElement.contains(t)&&(e._dndDropzoneActive=!0)}var n=v(e);!1!==this.isDropAllowed(n)&&e.preventDefault()}else this.cleanupDragoverState()},e.prototype.onDragOver=function(e){if(!e.defaultPrevented){var t=v(e);if(!1!==this.isDropAllowed(t)){this.checkAndUpdatePlaceholderPosition(e);var n=c(e,this.dndEffectAllowed);"none"!==n?(e.preventDefault(),h(e,n),this.dndDragover.emit(e),this.renderer.addClass(this.elementRef.nativeElement,this.dndDragoverClass)):this.cleanupDragoverState()}}},e.prototype.onDrop=function(e){try{var t=v(e);if(!1===this.isDropAllowed(t))return;var n=function d(e,t){var n=o(e);return!0===t?null!==n&&a(n)?JSON.parse(e.dataTransfer.getData(n)):{}:JSON.parse(e.dataTransfer.getData(n))}(e,D());if(!1===this.isDropAllowed(n.type))return;e.preventDefault();var r=c(e);if(h(e,r),"none"===r)return;var i=this.getPlaceholderIndex();if(-1===i)return;this.dndDrop.emit({event:e,dropEffect:r,isExternal:D(),data:n.data,index:i,type:t}),e.stopPropagation()}finally{this.cleanupDragoverState()}},e.prototype.onDragLeave=function(e){if("undefined"==typeof e._dndDropzoneActive){var t=document.elementFromPoint(e.clientX,e.clientY);if(this.elementRef.nativeElement.contains(t))return void(e._dndDropzoneActive=!0)}this.cleanupDragoverState(),h(e,"none")},e.prototype.isDropAllowed=function(e){if(!0===this.disabled)return!1;if(!0===D()&&!1===this.dndAllowExternal)return!1;if(!this.dndDropzone)return!0;if(!e)return!0;if(!1===Array.isArray(this.dndDropzone))throw new Error("dndDropzone: bound value to [dndDropzone] must be an array!");return-1!==this.dndDropzone.indexOf(e)},e.prototype.tryGetPlaceholder=function(){return"undefined"!=typeof this.dndPlaceholderRef?this.dndPlaceholderRef.elementRef.nativeElement:this.elementRef.nativeElement.querySelector("[dndPlaceholderRef]")},e.prototype.removePlaceholderFromDOM=function(){null!==this.placeholder&&null!==this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder)},e.prototype.checkAndUpdatePlaceholderPosition=function(e){if(null!==this.placeholder){this.placeholder.parentNode!==this.elementRef.nativeElement&&this.renderer.appendChild(this.elementRef.nativeElement,this.placeholder);var t=function r(e,t){for(var n=t;n.parentNode!==e;){if(!n.parentNode)return null;n=n.parentNode}return n}(this.elementRef.nativeElement,e.target);if(null!==t&&t!==this.placeholder)(function i(e,t,n){var r=t.getBoundingClientRect();return n?e.clientX<r.left+r.width/2:e.clientY<r.top+r.height/2})(e,t,this.dndHorizontal)?t.previousSibling!==this.placeholder&&this.renderer.insertBefore(this.elementRef.nativeElement,this.placeholder,t):t.nextSibling!==this.placeholder&&this.renderer.insertBefore(this.elementRef.nativeElement,this.placeholder,t.nextSibling)}},e.prototype.getPlaceholderIndex=function(){if(null===this.placeholder)return undefined;var e=this.elementRef.nativeElement;return Array.prototype.indexOf.call(e.children,this.placeholder)},e.prototype.cleanupDragoverState=function(){this.renderer.removeClass(this.elementRef.nativeElement,this.dndDragoverClass),this.removePlaceholderFromDOM()},e.decorators=[{type:i.Directive,args:[{selector:"[dndDropzone]"}]}],e.ctorParameters=function(){return[{type:i.NgZone},{type:i.ElementRef},{type:i.Renderer2}]},e.propDecorators={dndDropzone:[{type:i.Input}],dndEffectAllowed:[{type:i.Input}],dndAllowExternal:[{type:i.Input}],dndHorizontal:[{type:i.Input}],dndDragoverClass:[{type:i.Input}],dndDropzoneDisabledClass:[{type:i.Input}],dndDragover:[{type:i.Output}],dndDrop:[{type:i.Output}],dndPlaceholderRef:[{type:i.ContentChild,args:[E]}],dndDisableIf:[{type:i.Input}],dndDisableDropIf:[{type:i.Input}],onDrop:[{type:i.HostListener,args:["drop",["$event"]]}]},e}(),R=function(){function e(e){this.parent=e,this.draggable=!0,e.registerDragHandle(this)}return e.prototype.onDragEvent=function(e){this.parent.toggleDragLock(!1,null,!0),e._dndUsingHandle=!0},e.decorators=[{type:i.Directive,args:[{selector:"[dndHandle]"}]}],e.ctorParameters=function(){return[{type:y}]},e.propDecorators={draggable:[{type:i.HostBinding,args:["attr.draggable"]}],onDragEvent:[{type:i.HostListener,args:["dragstart",["$event"]]},{type:i.HostListener,args:["dragend",["$event"]]}]},e}(),I=function(){function e(){}return e.decorators=[{type:i.NgModule,args:[{imports:[t.CommonModule],declarations:[y,b,R,E,n],exports:[y,b,R,E,n]}]}],e}();e.DndDragImageRefDirective=n,e.DndDraggableDirective=y,e.DndPlaceholderRefDirective=E,e.DndDropzoneDirective=b,e.DndHandleDirective=R,e.DndModule=I,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-drag-drop.umd.min.js.map